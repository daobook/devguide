<!doctype html>
<html class="no-js" lang="zh_CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="next" title="Core Developer Motivations and Affiliations" href="motivations.html" /><link rel="prev" title="Dynamic Analysis with Clang" href="clang.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.01.02"/>
        <title>Running a buildbot worker - Python Developer&#39;s Guide</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Python Developer's Guide </div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/python-logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Python Developer's Guide </span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=搜索 name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Where to Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="pullrequest.html">Lifecycle of a Pull Request</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtests.html">Running &amp; Writing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="coverage.html">Increase Test Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="docquality.html">Helping with Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="documenting.html">Documenting Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="silencewarnings.html">Silence Warnings From the Test Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixingissues.html">Fixing “easy” Issues (and Beyond)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracker.html">Issue Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="triaging.html">Triaging an Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="communication.html">Following Python’s Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="porting.html">Porting Python to a new platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="coredev.html">How to Become a Core Developer</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developer Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="committing.html">Accepting Pull Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="devcycle.html">Development Cycle</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildbots.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="stdlibchanges.html">Adding to the Stdlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="langchanges.html">Changing the Python Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="experts.html">Experts Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdb.html">gdb Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="exploring.html">Exploring CPython’s Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="grammar.html">Changing CPython’s Grammar</a></li>
<li class="toctree-l1"><a class="reference internal" href="parser.html">Guide to CPython’s Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler.html">Design of CPython’s Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="garbage_collector.html">Design of CPython’s Garbage Collector</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Updating standard library extension modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="c-api.html">Changing Python’s C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="coverity.html">Coverity Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="clang.html">Dynamic Analysis with Clang</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Running a buildbot worker</a></li>
<li class="toctree-l1"><a class="reference internal" href="motivations.html">Core Developer Motivations and Affiliations</a></li>
<li class="toctree-l1"><a class="reference internal" href="gitbootcamp.html">Git Bootcamp and Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix: Topics</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="running-a-buildbot-worker">
<span id="buildworker"></span><h1>Running a buildbot worker<a class="headerlink" href="#running-a-buildbot-worker" title="永久链接至标题">¶</a></h1>
<p>Python’s <a class="reference internal" href="buildbots.html#buildbots"><span class="std std-ref">Continuous Integration</span></a> system was discussed earlier.  We sometimes refer to
the collection of <em>build workers</em> as our “buildbot fleet”.  The machines that
comprise the fleet are voluntarily contributed resources.  Many are run by
individual volunteers out of their own pockets and time, while others are
supported by corporations.  Even the corporate sponsored buildbots, however,
tend to exist because some individual championed them, made them a reality, and
is committed to maintaining them.</p>
<p>Anyone can contribute a buildbot to the fleet.  This chapter describes how
to go about setting up a buildbot worker, getting it added, and some hints about
buildbot maintenance.</p>
<p>Anyone running a buildbot that is part of the fleet should subscribe to the
<a class="reference external" href="https://mail.python.org/mailman/listinfo/python-buildbots">python-buildbots</a>
mailing list.  This mailing list is also the place to contact if you want to
contribute a buildbot but have questions.</p>
<p>As for what kind of buildbot to run…take a look at our <a class="reference external" href="http://buildbot.python.org/all/#/workers">current fleet</a>.  Pretty much anything that isn’t
on that list would be interesting: different Linux/UNIX distributions,
different versions of the various OSes, other OSes if you or someone are
prepared to make the test suite actually pass on that new OS.  Even if you only
want to run an OS that’s already on our list there may be utility in setting it
up; we also need to build and test python under various alternate build
configurations.  Post to the mailing list and talk about what you’d like to
contribute.</p>
<section id="preparing-for-buildbot-worker-setup">
<h2>Preparing for buildbot worker setup<a class="headerlink" href="#preparing-for-buildbot-worker-setup" title="永久链接至标题">¶</a></h2>
<p>Since the goal is to build Python from source, the system will need to have
everything required to do normal python development:  a compiler, a linker, and
(except on windows) the “development” headers for any of the optional modules
(zlib, OpenSSL, etc) supported by the platform.  Follow the steps outlined in
<a class="reference internal" href="setup.html#setup"><span class="std std-ref">Getting Started</span></a> for the target platform, all the way through to having a working
compiled python.</p>
<p>In order to set up the buildbot software, you will need to obtain an identifier
and password for your worker so it can join the fleet.  Email
<a class="reference external" href="mailto:python-buildbots%40python.org">python-buildbots<span>@</span>python<span>.</span>org</a> to discuss adding your worker and to obtain the
needed workername and password.  You can do some of the steps that follow
before having the credentials, but it is easiest to have them before
the “buildbot worker” step below.</p>
</section>
<section id="setting-up-the-buildbot-worker">
<h2>Setting up the buildbot worker<a class="headerlink" href="#setting-up-the-buildbot-worker" title="永久链接至标题">¶</a></h2>
<section id="conventional-always-on-machines">
<h3>Conventional always-on machines<a class="headerlink" href="#conventional-always-on-machines" title="永久链接至标题">¶</a></h3>
<p>You need a recent version of the <a class="reference external" href="https://buildbot.net/">buildbot</a> software,
and you will probably want a separate ‘buildbot’ user to run the buildbot
software.  You may also want to set the buildbot up using a virtual
environment, depending on how you manage your system.  We won’t cover how to that
here; it doesn’t differ from setting up a virtual environment for any other
software, but you’ll need to modify the sequence of steps below as appropriate
if you choose that path.</p>
<p>For Linux:</p>
<blockquote>
<div><ul class="simple">
<li><p>If your package manager provides the buildbot worker software, that is
probably the best way to install it; it may create the buildbot user for
you, in which case you can skip that step.  Otherwise, do <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span>
<span class="pre">buildbot-worker</span></code>.</p></li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> user (using, eg: <code class="docutils literal notranslate"><span class="pre">useradd</span></code>) if necessary.</p></li>
<li><p>Log in as the buildbot user.</p></li>
</ul>
</div></blockquote>
<p>For Mac:</p>
<blockquote>
<div><ul class="simple">
<li><p>Create a buildbot user using the OS/X control panel user admin.  It
should be a “standard” user.</p></li>
<li><p>Log in as the buildbot user.</p></li>
<li><p>Install the buildbot worker <a class="footnote-reference brackets" href="#id4" id="id1">1</a> by running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">buildbot-worker</span></code>.</p></li>
</ul>
</div></blockquote>
<p>For Windows:</p>
<blockquote>
<div><ul class="simple">
<li><p>Create a buildbot user as a “standard” user.</p></li>
<li><p>Install the latest version of Python from python.org.</p></li>
<li><p>Open a Command Prompt.</p></li>
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pypiwin32</span> <span class="pre">buildbot-worker</span></code> (note that
<code class="docutils literal notranslate"><span class="pre">python.exe</span></code> is not added to <code class="docutils literal notranslate"><span class="pre">PATH</span></code> by default, making the
<code class="docutils literal notranslate"><span class="pre">python</span></code> command accessible is left as an exercise for the user).</p></li>
</ul>
</div></blockquote>
<p>In a terminal window for the buildbot user, issue the following commands (you
can put the <code class="docutils literal notranslate"><span class="pre">buildarea</span></code> wherever you want to):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir buildarea
buildbot-worker create-worker buildarea buildbot.python.org:9020 workername workerpasswd
</pre></div>
</div>
<p>(Note that on Windows, the <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> command will be in the
<code class="file docutils literal notranslate"><span class="pre">Scripts</span></code> directory of your Python installation.)</p>
<p>Once this initial worker setup completes, you should edit the files
<code class="docutils literal notranslate"><span class="pre">buildarea/info/admin</span></code> and <code class="docutils literal notranslate"><span class="pre">buildarea/info/host</span></code> to provide your contact
info and information on the host configuration, respectively.  This information
will be presented in the buildbot web pages that display information about the
builders running on your worker.</p>
<p>You will also want to make sure that the worker is started when the
machine reboots:</p>
<p>For Linux:</p>
<blockquote>
<div><ul>
<li><p>Add the following line to <code class="docutils literal notranslate"><span class="pre">/etc/crontab</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>@reboot buildbot-worker restart /path/to/buildarea
</pre></div>
</div>
<p>Note that we use <code class="docutils literal notranslate"><span class="pre">restart</span></code> rather than <code class="docutils literal notranslate"><span class="pre">start</span></code> in case a crash has
left a <code class="docutils literal notranslate"><span class="pre">twistd.pid</span></code> file behind.</p>
</li>
</ul>
</div></blockquote>
<p>For OSX:</p>
<blockquote>
<div><blockquote>
<div><ul>
<li><p>Create a bin directory for your buildbot user:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir bin
</pre></div>
</div>
</li>
<li><p>Place the following script, named <code class="docutils literal notranslate"><span class="pre">run_worker.sh</span></code>, into that directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/usr/local/bin:/Library/Frameworks/Python.framework/Versions/2.7/bin:<span class="nv">$PATH</span>
<span class="nb">export</span> <span class="nv">LC_CTYPE</span><span class="o">=</span>en_US.utf-8
<span class="nb">cd</span> /Users/buildbot/buildarea
twistd --nodaemon --python<span class="o">=</span>buildbot.tac --logfile<span class="o">=</span>buildbot.log --prefix<span class="o">=</span>worker
</pre></div>
</div>
<p>If you use pip with Apple’s system python, add ‘/System’ to the front of
the path to the Python bin directory.</p>
</li>
</ul>
</div></blockquote>
<ul>
<li><p>Place a file with the following contents into <code class="docutils literal notranslate"><span class="pre">/Library/LaunchDaemons</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN"</span>
<span class="cp">      "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
      <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
      <span class="nt">&lt;string&gt;</span>net.buildbot.worker<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;key&gt;</span>UserName<span class="nt">&lt;/key&gt;</span>
      <span class="nt">&lt;string&gt;</span>buildbot<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;key&gt;</span>WorkingDirectory<span class="nt">&lt;/key&gt;</span>
      <span class="nt">&lt;string&gt;</span>/Users/buildbot/buildarea<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
      <span class="nt">&lt;array&gt;</span>
              <span class="nt">&lt;string&gt;</span>/Users/buildbot/bin/run_worker.sh<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;/array&gt;</span>
      <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;</span>
      <span class="nt">&lt;string&gt;</span>twistd.log<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;</span>
      <span class="nt">&lt;string&gt;</span>twistd.log<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;key&gt;</span>KeepAlive<span class="nt">&lt;/key&gt;</span>
      <span class="nt">&lt;true/&gt;</span>
      <span class="nt">&lt;key&gt;</span>SessionCreate<span class="nt">&lt;/key&gt;</span>
      <span class="nt">&lt;true/&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</pre></div>
</div>
<p>The recommended name for the file is <code class="docutils literal notranslate"><span class="pre">net.buildbot.worker</span></code>.</p>
</li>
</ul>
</div></blockquote>
<p>For Windows:</p>
<blockquote>
<div><ul class="simple">
<li><p>Add a Scheduled Task to run <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">start</span> <span class="pre">buildarea</span></code> as the
buildbot user “when the computer starts up”.  It is best to provide
absolute paths to the <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> command and the <code class="file docutils literal notranslate"><span class="pre">buildarea</span></code>
directory.  It is also recommended to set the task to run in the
directory that contains the <code class="file docutils literal notranslate"><span class="pre">buildarea</span></code> directory.</p></li>
<li><p>Alternatively (note: don’t do both!), set up the worker
service as described in the <a class="reference external" href="http://trac.buildbot.net/wiki/RunningBuildbotOnWindows#Service">buildbot documentation</a>.</p></li>
</ul>
</div></blockquote>
<p>To start the worker running for your initial testing, you can do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot-worker start buildarea
</pre></div>
</div>
<p>Then you can either wait for someone to make a commit, or you can pick a
builder associated with your worker from the <a class="reference external" href="http://buildbot.python.org/all/#/builders">list of builders</a> and force a build.</p>
<p>In any case you should initially monitor builds on your builders to make sure
the tests are passing and to resolve any platform issues that may be revealed
by tests that fail.  Unfortunately we do not currently have a way to notify you
only of failures on your builders, so doing periodic spot checks is also a good
idea.</p>
</section>
<section id="latent-workers">
<h3>Latent workers<a class="headerlink" href="#latent-workers" title="永久链接至标题">¶</a></h3>
<p>We also support running <a class="reference external" href="http://docs.buildbot.net/current/manual/configuration/workers.html#latent-workers">latent workers</a>
on the AWS EC2 service.  To set up such a worker:</p>
<blockquote>
<div><ul class="simple">
<li><p>Start an instance of your chosen base AMI and set it up as a
conventional worker.</p></li>
<li><p>After the instance is fully set up as a conventional worker (including
worker name and password, and admin and host information), create an AMI
from the instance and stop the instance.</p></li>
<li><p>Contact the buildmaster administrator who gave you your worker
name and password and give them the following information:</p>
<ul>
<li><p>Instance size (such as <code class="docutils literal notranslate"><span class="pre">m4.large</span></code>)</p></li>
<li><p>Full region specification (such as <code class="docutils literal notranslate"><span class="pre">us-west-2</span></code>)</p></li>
<li><p>AMI ID (such as <code class="docutils literal notranslate"><span class="pre">ami-1234beef</span></code>)</p></li>
<li><p>An Access Key ID and Access Key.  It is recommended to set up
a separate IAM user with full access to EC2 and provide the access key
information for that user rather than for your main account.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>The buildmaster cannot guarantee that it will always shut down your
instance(s), so it is recommended to periodically check and make sure
there are no “zombie” instances running on your account, created by the
buildbot master.  Also, if you notice that your worker seems to have been
down for an unexpectedly long time, please ping the <a class="reference external" href="https://mail.python.org/mailman/listinfo/python-buildbots">python-buildbots</a> list to
request that the master be restarted.</p>
<p>Latent workers should also be updated periodically to include operating system
or other software updates, but when to do such maintenance is largely up to you
as the worker owner.  There are a couple different options for doing such
updates:</p>
<blockquote>
<div><ul class="simple">
<li><p>Start an instance from your existing AMI, do updates on that instance,
and save a new AMI from the updated instance.  Note that (especially for
Windows workers) you should do at least one restart of the instance after
doing updates to be sure that any post-reboot update work is done before
creating the new AMI.</p></li>
<li><p>Create an entirely new setup from a newer base AMI using your existing
worker name and password.</p></li>
</ul>
</div></blockquote>
<p>Whichever way you choose to update your AMI, you’ll need to provide the
buildmaster administrators with the new AMI ID.</p>
</section>
</section>
<section id="buildbot-worker-operation">
<h2>Buildbot worker operation<a class="headerlink" href="#buildbot-worker-operation" title="永久链接至标题">¶</a></h2>
<p>Most of the time, running a worker is a “set and forget” operation,
depending on the level of involvement you want to have in resolving bugs
revealed by your builders.  There are, however, times when it is helpful or
even necessary for you to get involved.  As noted above, you should be
subscribed to <code class="docutils literal notranslate"><span class="pre">python-buildbots@python.org</span></code> so that you will be made
aware of any fleet-wide issues.</p>
<p>Necessary tasks include, obviously, keeping the buildbot running.  Currently
the system for notifying buildbot owners when their workers go offline is not
working; this is something we hope to resolve.  So currently it is helpful if
you periodically check the status of your worker.  We will also contact you
via your contact address in <code class="docutils literal notranslate"><span class="pre">buildarea/info/admin</span></code> when we notice there is a
problem that has not been resolved for some period of time and you have
not responded to a posting on the python-buildbots list about it.</p>
<p>We currently do not have a minimum version requirement for the worker
software.  However, this is something we will probably establish as we tune the
fleet, so another task will be to occasionally upgrade the buildbot worker software.
Coordination for this will be done via <code class="docutils literal notranslate"><span class="pre">python-buildbots@python.org</span></code>.</p>
<p>The most interesting extra involvement is when your worker reveals a unique
or almost-unique problem:  a test that is failing on your system but not on
other systems.  In this case you should be prepared to offer debugging help to
the people working on the bug: running tests by hand on the worker machine
or, if possible, providing ssh access to a committer to run experiments to try
to resolve the issue.</p>
</section>
<section id="required-ports">
<h2>Required Ports<a class="headerlink" href="#required-ports" title="永久链接至标题">¶</a></h2>
<p>The worker operates as a <em>client</em> to the <em>buildmaster</em>.  This means that
all network connections are <em>outbound</em>.  This is true also for the network
tests in the test suite.  Most consumer firewalls will allow any outbound
traffic, so normally you do not need to worry about what ports the buildbot
uses.  However, corporate firewalls are sometimes more restrictive, so here is
a table listing all of the outbound ports used by the buildbot and the python
test suite (this list may not be complete as new tests may have been added
since this table was last vetted):</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 9%"/>
<col style="width: 26%"/>
<col style="width: 65%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Port</p></th>
<th class="head"><p>Host</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>20, 21</p></td>
<td><p>ftp.debian.org</p></td>
<td><p>test_urllib2net</p></td>
</tr>
<tr class="row-odd"><td><p>53</p></td>
<td><p>your DNS server</p></td>
<td><p>test_socket, and others implicitly</p></td>
</tr>
<tr class="row-even"><td><p>80</p></td>
<td><p>python.org
example.com</p></td>
<td><p>(several tests)</p></td>
</tr>
<tr class="row-odd"><td><p>119</p></td>
<td><p>news.gmane.org</p></td>
<td><p>test_nntplib</p></td>
</tr>
<tr class="row-even"><td><p>443</p></td>
<td><p>(various)</p></td>
<td><p>test_ssl</p></td>
</tr>
<tr class="row-odd"><td><p>465</p></td>
<td><p>smtp.gmail.com</p></td>
<td><p>test_smtpnet</p></td>
</tr>
<tr class="row-even"><td><p>587</p></td>
<td><p>smtp.gmail.com</p></td>
<td><p>test_smtpnet</p></td>
</tr>
<tr class="row-odd"><td><p>9020</p></td>
<td><p>python.org</p></td>
<td><p>connection to buildmaster</p></td>
</tr>
</tbody>
</table></div>
<p>Many tests will also create local TCP sockets and connect to them, usually
using either <code class="docutils literal notranslate"><span class="pre">localhost</span></code> or <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>.</p>
</section>
<section id="required-resources">
<h2>Required Resources<a class="headerlink" href="#required-resources" title="永久链接至标题">¶</a></h2>
<p>Based on the last time we did a <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2012-March/117978.html">survey</a> on
buildbot requirements, the recommended resource allocations for a python
buildbot are at least:</p>
<blockquote>
<div><ul class="simple">
<li><p>2 CPUs</p></li>
<li><p>512 MB RAM</p></li>
<li><p>30 GB free disk space</p></li>
</ul>
</div></blockquote>
<p>The bigmem tests won’t run in this configuration, since they require
substantially more memory, but these resources should be sufficient to ensure
that Python compiles correctly on the platform and can run the rest of the test
suite.</p>
</section>
<section id="security-considerations">
<h2>Security Considerations<a class="headerlink" href="#security-considerations" title="永久链接至标题">¶</a></h2>
<p>We only allow builds to be triggered against commits to the
<a class="reference external" href="https://github.com/python/cpython">CPython repository on GitHub</a>.
This means that the code your buildbot will run will have been vetted by a committer.
However, mistakes and bugs happen, as could a compromise, so keep this in mind when
siting your buildbot on your network and establishing the security around it.
Treat the buildbot like you would any resource that is public facing and might
get hacked (use a VM and/or jail/chroot/solaris zone, put it in a DMZ, etc).
While the buildbot does not have any ports open for inbound traffic (and is not
public facing in that sense), committer mistakes do happen, and security flaws
are discovered in both released and unreleased code, so treating the buildbot
as if it were fully public facing is a good policy.</p>
<p>Code runs differently as privileged and unprivileged users.  We would love to
have builders running as privileged accounts, but security considerations do
make that difficult, as access to root can provide access to surprising
resources (such as spoofed IP packets, changes in MAC addresses, etc) even on a
VM setup.  But if you are confident in your setup, we’d love to have a buildbot
that runs python as root.</p>
<p>Note that the above is a summary of a <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2011-October/113935.html">discussion</a> on
python-dev about buildbot security that includes examples of the tests for
which privilege matters.  There was no final consensus, but the information is
useful as a point of reference.</p>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>If the buildbot is going to do Framework builds, it is better to
use the Apple-shipped Python so as to avoid any chance of the buildbot
picking up components from the installed python.org python.</p>
</dd>
</dl>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="motivations.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Core Developer Motivations and Affiliations</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="clang.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Dynamic Analysis with Clang</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2011-2022, Python Software Foundation |
            最后更新于 3月 10, 2022. |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="_sources/buildworker.rst.txt"
               rel="nofollow">
              显示源代码
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            目录
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Running a buildbot worker</a><ul>
<li><a class="reference internal" href="#preparing-for-buildbot-worker-setup">Preparing for buildbot worker setup</a></li>
<li><a class="reference internal" href="#setting-up-the-buildbot-worker">Setting up the buildbot worker</a><ul>
<li><a class="reference internal" href="#conventional-always-on-machines">Conventional always-on machines</a></li>
<li><a class="reference internal" href="#latent-workers">Latent workers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#buildbot-worker-operation">Buildbot worker operation</a></li>
<li><a class="reference internal" href="#required-ports">Required Ports</a></li>
<li><a class="reference internal" href="#required-resources">Required Resources</a></li>
<li><a class="reference internal" href="#security-considerations">Security Considerations</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/translations.js"></script>
    </body>
</html>